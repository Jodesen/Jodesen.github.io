<!DOCTYPE html>
<html>
<head>
  <title>多位数除两位数</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      background-color: #f4f7f6; /* Slightly off-white background */
    }

    h1 {
      margin-bottom: 20px;
      color: #333;
    }

    .controls-container { /* Container for select and buttons */
        margin-bottom: 20px;
        padding: 15px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .select-container { /* Container for the select dropdown */
        margin-bottom: 15px;
    }

    label[for="numProblemsSelect"] {
        font-size: 16px;
        vertical-align: middle;
        color: #555;
    }

    #numProblemsSelect {
        padding: 8px 10px; /* Increased padding */
        font-size: 16px;
        margin-left: 8px;
        border-radius: 5px; /* Rounded corners */
        border: 1px solid #ccc;
        background-color: #fff; /* White background */
        vertical-align: middle;
        cursor: pointer;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
      margin: 5px; /* Adjusted margin for better spacing */
      border-radius: 5px;
      transition: background-color 0.3s, transform 0.1s;
    }
    button:hover {
        background-color: #2980b9;
    }
    button:active {
        transform: scale(0.98); /* Add press effect */
    }


    #problemTableWrapper {
      display: flex;
      justify-content: center;
      overflow-x: auto;
      width: 100%;
    }

    #problemTable {
      display: none; /* Initially hidden */
      border-collapse: collapse;
      margin: 20px auto; /* Added top/bottom margin */
      width: 100%; /* Default width */
      max-width: 600px; /* Max width for larger screens */
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      border: 1px solid #eee; /* Subtle border */
    }

     /* Remove thead styles from desktop as we change structure */
    /* #problemTable th { ... } */

    #problemTable td {
      /* General TD styles for single-column layout */
      border-bottom: 1px solid #eee; /* Separator line */
      padding: 12px 15px; /* Padding */
      text-align: left; /* Align left */
      display: flex; /* Use flex for alignment */
      justify-content: space-between; /* Space out text and input */
      align-items: center; /* Vertically center */
      flex-wrap: wrap; /* Allow wrapping if needed */
    }
     /* Style last cell differently */
    #problemTable tr:last-child td {
        border-bottom: none;
    }


    input[type="number"].input { /* Use class selector */
      padding: 6px 8px;
      font-size: 16px;
      width: 70px; /* Slightly wider */
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-left: 15px; /* Space from text */
      flex-shrink: 0;
    }

    #instructions {
      margin-top: 20px;
      font-size: 14px; /* Slightly smaller */
      color: #666; /* Darker gray */
      padding: 10px;
      background-color: #eaf2f8; /* Light blue background */
      border: 1px solid #c5d9e8;
      border-radius: 5px;
      text-align: left;
      line-height: 1.5; /* Better readability */
    }

    #problemTableContainer {
      display: flex;
      justify-content: center;
      width: 100%;
    }

    #correctAnswers,
    #historyRecords {
        display: none; /* Hidden by default */
        margin-top: 20px;
        text-align: left;
        padding: 15px; /* More padding */
        border: 1px solid #ddd; /* Slightly darker border */
        background-color: #fff; /* White background */
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    #historyRecords h2, #correctAnswers h2 {
        margin-top: 0;
        font-size: 18px; /* Larger headings */
        color: #333;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
        margin-bottom: 12px;
    }
    #correctAnswers div, #historyRecords div {
        margin-bottom: 8px; /* Increased spacing */
        line-height: 1.5;
    }
    #correctAnswers strong, #historyRecords strong {
        color: #3498db; /* Highlight important parts */
    }


    /* --- 移动端适配样式 --- */
    @media (max-width: 600px) {
      body {
        padding: 10px;
        font-size: 15px; /* Slightly larger base for mobile */
      }

      h1 {
        font-size: 22px; /* Adjusted H1 */
      }

       .controls-container {
            padding: 10px;
       }

        label[for="numProblemsSelect"] {
            font-size: 15px; /* Adjust label size */
        }
        #numProblemsSelect {
            padding: 8px;
            font-size: 15px;
        }

      button {
        padding: 10px 15px;
        font-size: 15px;
        width: calc(50% - 10px); /* Maintain side-by-side buttons */
        margin: 5px;
      }

      #problemTableWrapper {
         overflow-x: visible; /* Disable horizontal scroll */
      }

      #problemTable {
         margin: 15px auto; /* Adjust margin */
         border-radius: 5px; /* Slightly smaller radius */
      }

      /* Hide thead always now, as structure changed */
      #problemTable thead {
          display: none;
      }

      /* TD styles are already mostly mobile-friendly due to single-column design */
      #problemTable td {
          padding: 10px 12px; /* Adjust padding */
          flex-direction: row; /* Ensure row direction */
      }

      input[type="number"].input {
          padding: 6px;
          font-size: 15px;
          width: 65px;
          margin-left: 10px; /* Adjust margin */
      }

      #instructions {
          font-size: 13px;
          padding: 8px;
      }

      #correctAnswers, #historyRecords {
          padding: 12px; /* Adjust padding */
          font-size: 14px;
      }
      #correctAnswers h2, #historyRecords h2 {
          font-size: 16px;
      }
      #correctAnswers div, #historyRecords div {
          margin-bottom: 6px;
      }
    }
  </style>
  <script>
    var startTime;
    var practiceCount = 0;

    function generateProblems() {
      clearCorrectAnswers(); // Clear previous results
      practiceCount++; // Increment practice counter
      startTime = Date.now(); // Record start time

      // --- Get selected number of problems ---
      const numToGenerate = parseInt(document.getElementById('numProblemsSelect').value);
      // ---

      var problemsTable = document.getElementById("problemTable");
      var tbody = problemsTable.querySelector("tbody");

      // Ensure tbody exists, create if not
      if (!tbody) {
          tbody = document.createElement("tbody");
          problemsTable.appendChild(tbody);
      }
      tbody.innerHTML = ''; // Clear previous problems from tbody

      // --- Generate 'numToGenerate' problems ---
      for (var i = 0; i < numToGenerate; i++) {
          var num1 = Math.floor(Math.random() * 90000) + 10000; // 5-digit number
          var num2 = Math.floor(Math.random() * 90) + 10;   // 2-digit number
          var result = Math.floor(num1 / num2);             // Integer division result
          var firstDigit = result.toString().charAt(0);     // First digit of the result

          var newRow = tbody.insertRow(); // Create a new row for each problem
          var cell = newRow.insertCell(); // Create a cell in the row

          // Create and add the text part of the problem
          const problemText = document.createTextNode(`${i + 1}. ${num1} ÷ ${num2} = `); // Add problem number
          cell.appendChild(problemText);

          // Create the input element
          const inputElement = document.createElement("input");
          inputElement.type = "number";
          inputElement.dataset.answer = firstDigit; // Store correct first digit in data attribute
          inputElement.classList.add("input");     // Add class for styling/selection
          inputElement.setAttribute("aria-label", `Answer for problem ${i + 1}`); // Accessibility

          // Add the input element to the cell
          cell.appendChild(inputElement);
      }

       problemsTable.style.display = "table"; // Use 'table' display for proper rendering


      var inputs = document.querySelectorAll('.input');
      inputs.forEach(input => {
          input.disabled = false;
          input.style.backgroundColor = "";
          input.value = "";
      });

       // Optional: Focus the first input field
       if (inputs.length > 0) {
           inputs[0].focus();
       }
    }

    function verifyAnswers() {
      var inputs = document.querySelectorAll('.input[data-answer]');
      if (inputs.length === 0 || inputs[0].disabled) {
          alert("请先生成新的题目再验证！");
          return;
      }
      if (!startTime) {
          alert("无法计算时间，请重新生成题目。");
          return;
      }

      var endTime = Date.now();
      var totalTime = (endTime - startTime) / 1000;
      var correctCount = 0;
      var incorrectProblems = [];

      for (var i = 0; i < inputs.length; i++) {
          var input = inputs[i];
          var userAnswer = input.value.trim().charAt(0);
          var correctAnswer = input.dataset.answer;

          let problemTextNode = Array.from(input.parentNode.childNodes).find(node => node.nodeType === Node.TEXT_NODE);
          let problemText = problemTextNode ? problemTextNode.textContent.trim() : `题目 ${i+1}`; // Fallback text
          problemText = problemText.replace('=', '').trim(); // Clean up

          if (userAnswer === correctAnswer) {
              input.style.backgroundColor = "lightgreen";
              correctCount++;
          } else {
              input.style.backgroundColor = "pink";
              incorrectProblems.push({
                  problem: problemText,
                  correctAnswer: correctAnswer,
                  userAnswer: userAnswer || '未作答'
              });
          }
          input.disabled = true;
      }

      var accuracy = (inputs.length > 0) ? (correctCount / inputs.length) * 100 : 0; // Avoid division by zero

      // Display results
      var correctAnswersDiv = document.getElementById("correctAnswers");
      correctAnswersDiv.innerHTML = ""; // Clear previous results
      correctAnswersDiv.style.display = "block"; // Show results area

      var resultTitle = document.createElement("h2");
      resultTitle.textContent = "本次练习结果";
      correctAnswersDiv.appendChild(resultTitle);

      var infoDiv = document.createElement("div");
      infoDiv.innerHTML = `<strong>题目数量：</strong>${inputs.length}<br>
                           <strong>用时：</strong>${totalTime.toFixed(1)}秒<br>
                           <strong>正确率：</strong>${accuracy.toFixed(1)}% (${correctCount}/${inputs.length})`;
      correctAnswersDiv.appendChild(infoDiv);

      if (incorrectProblems.length > 0) {
          var incorrectTitleDiv = document.createElement("div");
          incorrectTitleDiv.innerHTML = "<br><strong>错误题目详情：</strong>";
          incorrectTitleDiv.style.marginTop = "10px";
          correctAnswersDiv.appendChild(incorrectTitleDiv);
          for (var j = 0; j < incorrectProblems.length; j++) {
              var problemDiv = document.createElement("div");
               // Highlight user's wrong answer and show correct one
              problemDiv.innerHTML = `${incorrectProblems[j].problem} = <span style="color: red; text-decoration: line-through;">${incorrectProblems[j].userAnswer}</span> ... (正确首位: <strong>${incorrectProblems[j].correctAnswer}</strong>)`;
              problemDiv.style.marginBottom = "3px";
              correctAnswersDiv.appendChild(problemDiv);
          }
      } else if(inputs.length > 0) { // Only show if problems were generated
          var allCorrectDiv = document.createElement("div");
          allCorrectDiv.innerHTML = "<br><strong style='color: green;'>太棒了，全部正确！继续努力！</strong>";
          correctAnswersDiv.appendChild(allCorrectDiv);
      }

      updateHistoryRecords(practiceCount, inputs.length, totalTime.toFixed(1), accuracy.toFixed(1)); // Pass total problems count

      // Make history visible
      document.getElementById("historyRecords").style.display = "block";

      startTime = null; // Reset start time
    }

    function clearCorrectAnswers() {
      var correctAnswersDiv = document.getElementById("correctAnswers");
      if (correctAnswersDiv) { // Check if element exists
          correctAnswersDiv.innerHTML = "";
          correctAnswersDiv.style.display = "none";
      }

    }

    // Updated to include total problems count
    function updateHistoryRecords(practiceNum, totalProblems, time, accuracy) {
        var historyDiv = document.getElementById("historyRecords");
        if (!historyDiv) return; // Exit if div doesn't exist

        var historyTitle = historyDiv.querySelector('h2');
        if (!historyTitle) {
            historyTitle = document.createElement("h2");
            historyTitle.textContent = "历史练习记录";
            historyDiv.insertBefore(historyTitle, historyDiv.firstChild);
        }

        var recordDiv = document.createElement("div");
        // Include total problems in the history record
        recordDiv.textContent = `第 ${practiceNum} 次 (${totalProblems}题) - 用时：${time}秒，正确率：${accuracy}%`;

        // Insert new record after the title
        historyDiv.insertBefore(recordDiv, historyTitle.nextSibling);
    }
  </script>
</head>
<body>

  <h1>多位数除两位数练习题</h1>

  <div class="controls-container">
      <div class="select-container">
          <label for="numProblemsSelect">题目数量：</label>
          <select id="numProblemsSelect">
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="15">15</option>
              <option value="20" selected>20</option> <option value="25">25</option>
              <option value="30">30</option>
          </select>
      </div>
      <div>
          <button onclick="generateProblems()">生成题目</button>
          <button onclick="verifyAnswers()">验证答案</button>
      </div>
  </div>

  <div id="problemTableContainer">
    <table id="problemTable">
      <tbody>
          </tbody>
    </table>
  </div>

  <p id="instructions">【说明】：请从上方选择题目数量。对于每个题目（多位数 ÷ 两位数），只需在右侧输入框中输入**商的首位**数字，无需四舍五入。例如：85313 ÷ 41 的商是 2xx，只需输入 2。</p>

  <div id="correctAnswers" style="display: none;">
      </div>
  <div id="historyRecords" style="display: none;">
      </div>

</body>
</html>
